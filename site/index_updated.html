<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0B1020" />
  <title>RamIA PWA Launcher</title>
  <meta name="description" content="RamIA Progressive Web App launcher. Opens the local dashboard directly without third-party redirects." />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <main class="launcher-shell">
    <section class="card">
      <p class="eyebrow">RamIA Progressive Web App</p>
      <h1>Launch your local dashboard</h1>
      <p class="subtitle">This entry point bypasses misconfigured external redirects and opens the dashboard from local project routes.</p>

      <div class="actions">
        <a id="openDashboard" class="btn btn-primary" href="./index.html" aria-label="Open Dashboard">Open Dashboard</a>
        <button id="installPwa" class="btn btn-secondary" type="button">Install App</button>
      </div>

      <p id="statusText" class="status">Redirecting to dashboardâ€¦</p>
      <noscript><p class="status">JavaScript is disabled. Use <strong>Open Dashboard</strong> to continue.</p></noscript>
    </section>
  </main>

  <script>
    (function () {
      const DASHBOARD_PATH = './index.html';
      const statusText = document.getElementById('statusText');
      const installButton = document.getElementById('installPwa');
      let deferredPrompt = null;

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            await navigator.serviceWorker.register('./sw.js');
          } catch (error) {
            statusText.textContent = 'Service worker unavailable in this environment.';
          }
        });
      } else {
        statusText.textContent = 'This browser does not support service workers.';
      }

      window.addEventListener('beforeinstallprompt', (event) => {
        event.preventDefault();
        deferredPrompt = event;
        installButton.disabled = false;
      });

      installButton.addEventListener('click', async () => {
        if (!deferredPrompt) {
          statusText.textContent = 'Install is not available right now. Open from HTTPS or localhost.';
          return;
        }
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        installButton.disabled = true;
      });

      window.setTimeout(() => {
        window.location.replace(DASHBOARD_PATH);
      }, 900);
    })();
  </script>
</body>
</html>
